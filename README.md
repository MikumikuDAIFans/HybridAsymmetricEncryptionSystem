# æ··åˆéå¯¹ç§°åŠ å¯†äº‘ç«¯åŒæ­¥ç³»ç»Ÿ (Hybrid Encryption System)

## 1. é¡¹ç›®ç®€ä»‹

æœ¬é¡¹ç›®å®ç°äº†ä¸€å¥—é«˜å®‰å…¨æ€§çš„æ··åˆæ¶æ„äº‘ç«¯ä¸æœ¬åœ°æ–‡ä»¶åŒæ­¥ç³»ç»Ÿï¼Œä¸“é—¨é’ˆå¯¹**â€œäº‘ç«¯æ˜æ–‡å­˜å‚¨ï¼Œå®‰å…¨ä¸‹äº‘åˆ†å‘â€**çš„åœºæ™¯è®¾è®¡ã€‚ç³»ç»Ÿé‡‡ç”¨â€œä¿¡å°åŠ å¯†â€ï¼ˆEnvelope Encryptionï¼‰æ¨¡å‹ï¼Œç»“åˆäº† **RSA-4096** éå¯¹ç§°åŠ å¯†ä¸ **AES-256-GCM** å¯¹ç§°åŠ å¯†çš„ä¼˜åŠ¿ã€‚

**æ ¸å¿ƒç‰¹æ€§ï¼š**
*   **å®‰å…¨ä¸‹äº‘æ¶æ„**ï¼šä¸Šä¼ æ˜æ–‡ï¼Œä¸‹è½½åŠ å¯†ã€‚ç¡®ä¿æ•°æ®åœ¨äº‘ç«¯å¯ç”¨ï¼ˆåˆ†æ/å®¡è®¡ï¼‰ï¼Œåœ¨åˆ†å‘é“¾è·¯ä¸­å®‰å…¨ï¼ˆé˜²çªƒå¬ï¼‰ï¼Œåœ¨ç»ˆç«¯å—æ§ï¼ˆæ— ç§é’¥ä¸å¯è¯»ï¼‰ã€‚
*   **æµå¼åŠ å¯†/è§£å¯†**ï¼šæœåŠ¡ç«¯ä¸å®¢æˆ·ç«¯å‡é‡‡ç”¨ç”Ÿæˆå™¨æ¨¡å¼ï¼Œæ”¯æŒè¶…å¤§æ–‡ä»¶æµå¼ä¼ è¾“ï¼Œå†…å­˜å ç”¨æ’å®š (O(1))ã€‚
*   **Docker åŒ–éƒ¨ç½²**ï¼šæœåŠ¡ç«¯å°è£…ä¸ºè½»é‡çº§ Alpine Docker é•œåƒã€‚
*   **èº«ä»½è®¤è¯ç³»ç»Ÿ**ï¼šå†…ç½®åŸºäº SQLite çš„ç”¨æˆ·è®¤è¯ç³»ç»Ÿï¼ˆé»˜è®¤ admin/admin123ï¼‰ï¼Œä¿æŠ¤æ–‡ä»¶è®¿é—®æƒé™ã€‚
*   **å¯†é’¥ç”Ÿå‘½å‘¨æœŸç®¡ç†**ï¼šæ”¯æŒ RSA å¯†é’¥å¯¹çš„ä¸»åŠ¨è½®æ¢ï¼ˆRotationï¼‰ï¼Œåœ¨å¯†é’¥æ³„éœ²æ—¶å¯ç«‹å³æ›´æ–°ã€‚
*   **åŒå®¢æˆ·ç«¯æ”¯æŒ**ï¼šæä¾›å‘½ä»¤è¡Œå·¥å…· (CLI) å’Œ Web å¯è§†åŒ–ç•Œé¢ (WebUI)ã€‚

---

## 2. å¿«é€Ÿå¼€å§‹

### 2.1 ç¯å¢ƒè¦æ±‚
*   **æ“ä½œç³»ç»Ÿ**ï¼šWindows 10/11
*   **Docker**ï¼šDocker Desktop for Windows
*   **Python**ï¼šPython 3.10+

### 2.2 ä¸€é”®éƒ¨ç½²ä¸æ¨¡æ‹Ÿ
æœ¬é¡¹ç›®æä¾›äº†ä¸€é”®è‡ªåŠ¨åŒ–è„šæœ¬ï¼Œç”¨äºæ„å»ºç¯å¢ƒå¹¶å¯åŠ¨æœ¬åœ°æ¨¡æ‹Ÿæµ‹è¯•ã€‚

1.  åŒå‡»æ ¹ç›®å½•ä¸‹çš„ **`build_simulation.bat`**ã€‚
2.  è„šæœ¬å°†è‡ªåŠ¨æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š
    *   æ£€æŸ¥ Python ä¸ Docker ç¯å¢ƒã€‚
    *   ç”Ÿæˆåˆå§‹ RSA-4096 å¯†é’¥å¯¹ã€‚
    *   åˆå§‹åŒ– SQLite ç”¨æˆ·æ•°æ®åº“ï¼ˆé»˜è®¤ç”¨æˆ·ï¼š`admin`ï¼Œå¯†ç ï¼š`admin123`ï¼‰ã€‚
    *   æ„å»ºæœåŠ¡ç«¯ Docker é•œåƒå¹¶å¯åŠ¨å®¹å™¨ï¼ˆæ˜ å°„ç«¯å£ 8000ï¼Œ**æŒä¹…åŒ–æ•°æ®åº“å­˜å‚¨**ï¼‰ã€‚
    *   å®‰è£…å®¢æˆ·ç«¯ä¾èµ–å¹¶æ‰“åŒ…ä¸º EXEã€‚
3.  è„šæœ¬æ‰§è¡Œå®Œæ¯•åï¼ŒæœåŠ¡ç«¯å°†è¿è¡Œåœ¨ `http://localhost:8000`ã€‚

### 2.3 ä½¿ç”¨ WebUI (æ¨è)
ä¸€é”®éƒ¨ç½²åï¼Œä½ å¯ä»¥å¯åŠ¨ WebUI è¿›è¡Œå¯è§†åŒ–æ“ä½œï¼š

```powershell
cd web_ui
streamlit run app.py
```

è®¿é—®æµè§ˆå™¨ `http://localhost:8501`ï¼š
*   **ç™»å½•**ï¼šè¾“å…¥é»˜è®¤è´¦å· `admin` / `admin123`ã€‚
*   **Server Module**ï¼šæŸ¥çœ‹äº‘ç«¯æ–‡ä»¶åˆ—è¡¨ï¼Œç‚¹å‡»ä¸‹è½½ï¼ˆæ­¤æ—¶ä¼šè‡ªåŠ¨åŠ å¯†ï¼‰ã€‚
*   **Local Module**ï¼šä¸Šä¼ æœ¬åœ°æ–‡ä»¶ï¼ˆæ˜æ–‡ä¸Šä¼ ï¼‰ï¼Œæˆ–è§£å¯†åˆšåˆšä¸‹è½½çš„åŠ å¯†æ–‡ä»¶ï¼ˆ`.enc` -> æ˜æ–‡ï¼‰ã€‚
*   **Key Management**ï¼šç‚¹å‡» "Rotate Key Pair" å¯ç”Ÿæˆæ–°çš„ RSA å¯†é’¥å¯¹ï¼Œæ—§ç§é’¥ä¼šè‡ªåŠ¨å¤‡ä»½ã€‚

### 2.4 ä½¿ç”¨ CLI å‘½ä»¤è¡Œ
ä½¿ç”¨ç”Ÿæˆçš„å®¢æˆ·ç«¯ EXE è¿›è¡Œæµ‹è¯•ï¼š

**ä¸Šä¼  (æ˜æ–‡)ï¼š**
```powershell
client\dist\HybridClient.exe upload <ä½ çš„æ–‡ä»¶è·¯å¾„> --user admin --pass admin123
```

**ä¸‹è½½ (è‡ªåŠ¨åŠ å¯†å¹¶æœ¬åœ°è§£å¯†)ï¼š**
```powershell
client\dist\HybridClient.exe download <æ–‡ä»¶å> --user admin --pass admin123
```

---

## 3. ç³»ç»Ÿæ¶æ„

### 3.1 ç›®å½•ç»“æ„

```text
/HybridAsymmetricEncryptionSystem
â”œâ”€â”€ build_simulation.bat      # ä¸€é”®æ„å»ºä¸éƒ¨ç½²è„šæœ¬
â”œâ”€â”€ gen_keys.py               # å¯†é’¥ç”Ÿæˆä¸æ•°æ®åº“åˆå§‹åŒ–å·¥å…·
â”œâ”€â”€ README.md                 # é¡¹ç›®æ–‡æ¡£
â”œâ”€â”€ æ··åˆéå¯¹ç§°åŠ å¯†ç®—æ³•å®ç°.md   # æ·±åº¦æŠ€æœ¯æŠ¥å‘Š
â”œâ”€â”€ ç³»ç»Ÿå·¥ä½œæµç¨‹æŠ¥å‘Š.md         # æµç¨‹ä¸æ—¶åºåˆ†æ
â”œâ”€â”€ server_uploads/           # [Dockeræ˜ å°„] äº‘ç«¯æ–‡ä»¶å­˜å‚¨ç›®å½• (æ˜æ–‡)
â”œâ”€â”€ web_ui/                   # WebUI æºç  (Streamlit)
â”‚   â”œâ”€â”€ app.py                # WebUI å…¥å£ (å«ç™»å½•ä¸å¯†é’¥ç®¡ç†)
â”‚   â””â”€â”€ downloads/            # WebUI ä¸‹è½½ç¼“å­˜ç›®å½•
â”œâ”€â”€ client/                   # å®¢æˆ·ç«¯æºç 
â”‚   â”œâ”€â”€ main.py               # CLI å…¥å£
â”‚ ğŸ¯â”œâ”€â”€ decryption_engine.py  # ************æµå¼è§£å¯†å¼•æ“************
â”‚   â”œâ”€â”€ client.spec           # PyInstaller æ‰“åŒ…é…ç½®
â”‚   â”œâ”€â”€ resources/            # [è‡ªåŠ¨ç”Ÿæˆ] å­˜æ”¾ RSA ç§é’¥ (private.pem)
â”‚   â””â”€â”€ requirements.txt      # å®¢æˆ·ç«¯ä¾èµ–
â””â”€â”€ server/                   # æœåŠ¡ç«¯æºç 
    â”œâ”€â”€ Dockerfile            # å¤šé˜¶æ®µæ„å»ºæ–‡ä»¶
    â”œâ”€â”€ requirements.txt      # æœåŠ¡ç«¯ä¾èµ–
    â””â”€â”€ app/
        â”œâ”€â”€ main.py           # FastAPI åº”ç”¨å…¥å£ (å« /rotate-keys æ¥å£)
      ğŸ¯â”œâ”€â”€ crypto_utils.py   # ************æµå¼åŠ å¯†æ ¸å¿ƒé€»è¾‘***************
        â”œâ”€â”€ user_manager.py   # ç”¨æˆ·æ•°æ®åº“ç®¡ç† (æ”¯æŒ Key Update)
        â””â”€â”€ users.db          # [Dockeræ˜ å°„] SQLite ç”¨æˆ·æ•°æ®åº“
```

### 3.2 HENC åè®®è§„èŒƒ (Hybrid Encrypted Content)

ç³»ç»Ÿå®šä¹‰äº†è‡ªå®šä¹‰çš„äºŒè¿›åˆ¶åè®®ç”¨äºä¼ è¾“åŠ å¯†æ•°æ®ï¼š

| åç§»é‡ | å­—æ®µ | é•¿åº¦ | æè¿° |
| :--- | :--- | :--- | :--- |
| 0x00 | **Magic** | 4 Bytes | å›ºå®šå€¼ `HENC` |
| 0x04 | **Version** | 1 Byte | åè®®ç‰ˆæœ¬ (0x01) |
| 0x05 | **Algo** | 1 Byte | ç®—æ³•æ ‡è¯† (0x01 = AES-GCM) |
| 0x06 | **Block Size** | 4 Bytes | åˆ†å—å¤§å° (Big-Endian, é»˜è®¤ 64KB) |
| 0x0A | **Base IV** | 12 Bytes | åŸºç¡€åˆå§‹åŒ–å‘é‡ |
| 0x16 | **Enc DEK Len** | 2 Bytes | åŠ å¯†åçš„ DEK é•¿åº¦ |
| 0x18 | **Enc DEK** | Var | RSA åŠ å¯†çš„ AES ä¼šè¯å¯†é’¥ |
| Var | **Payload** | Stream | è¿ç»­çš„å¯†æ–‡å—åºåˆ— |

**åŠ å¯†å—ç»“æ„ï¼š**
`[ Ciphertext (Block Size) ] + [ Auth Tag (16 Bytes) ]`

---

## 4. æ•…éšœæ’æŸ¥

*   **WebUI æŠ¥é”™ "Failed to import decryption_engine"**ï¼š
    *   ç¡®ä¿ä½ æ˜¯åœ¨ `web_ui` ç›®å½•ä¸‹è¿è¡Œ `streamlit run app.py`ã€‚
*   **ç‚¹å‡» Rotate Key Pair åæ— ååº”æˆ–æœªç”Ÿæ•ˆ**ï¼š
    *   æ£€æŸ¥ Docker å®¹å™¨æ˜¯å¦æ­£ç¡®æŒ‚è½½äº† `users.db`ã€‚å¦‚æœæ²¡æœ‰æŒ‚è½½ï¼Œå®¹å™¨é‡å¯åå¯†é’¥å˜æ›´ä¼šä¸¢å¤±ã€‚
*   **Docker ç«¯å£å†²çª**ï¼š
    *   ç¡®ä¿æœ¬åœ° 8000 ç«¯å£æœªè¢«å ç”¨ã€‚

---

## 5. å¼€å‘å›¢é˜Ÿ
*   Generated by Trae AI (Gemini-3-Pro-Preview)
*   Displace
